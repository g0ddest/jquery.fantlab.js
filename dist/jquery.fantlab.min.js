!function(t){var i,e={host:"/",search:"https://api.fantlab.ru/search.json?",params_in_class:!1,cross_domain:!0,expr:/(work|edition)\_([0-9])+/gi,async:!0,param_type:"data-fantlab_type",param_id:"data-fantlab_id",innercss_work:"box-shadow: 1px 1px 2px rgba(0,0,0,0.2);font-family: Verdana, Arial; line-height: 1.2; cursor: default; vertical-align: top; position: absolute; padding: 10px; width: 230px; border-width: 1px 4px 1px 1px; border-style: solid; border-color: #adb4b8 #0079ab #adb4b8 #adb4b8; color: rgb(0, 0, 0); text-align: left; top: 24px; right: -200px; z-index: 999; outline: none; display: none; background-color: rgb(249, 250, 251);",innercss_edition:"box-shadow: 1px 1px 2px rgba(0,0,0,0.2);font-family: Verdana, Arial; line-height: 1.2; cursor: default; vertical-align: top; position: absolute; padding: 10px; width: 230px; border-width: 1px 4px 1px 1px; border-style: solid; border-color: #adb4b8 #C45E24 #adb4b8 #adb4b8; color: rgb(0, 0, 0); text-align: left; top: 24px; right: -200px; z-index: 999; outline: none; display: none; background-color: rgb(249, 250, 251);",corner:"<span style='display: block!important; box-shadow: -1px 1px 0px rgba(0,0,0,0.2);width: 12px;height: 12px; position: absolute;margin-left: 20px;margin-top: -16px;background-color: rgb(249,250,251);z-index: 980;-webkit-transform: rotate(135deg);transform: rotate(135deg);'></span>"};t.fn.fantlab=function(a){i=t.extend({},e,i,a);var n=this;t(this).on("mouseenter mouseleave",function(i){var e=t(this).find("div");"mouseenter"===i.type?(clearTimeout(e.data("timeout")),t.each(t(n).find("div"),function(i,a){var n=t(a);n.html()!==e.html()&&n.hide()}),e.data("timeout",setTimeout(function(){e.slideDown("fast")},600))):(clearTimeout(e.data("timeout")),e.data("timeout",setTimeout(function(){e.slideUp("fast")},300)))});var s=this,o=[],r=[];if(t(this).length>0){t.each(t(this),function(){if(t(this).attr("style","position:relative;"),i.params_in_class)var e=i.exec(t(this).attr("class"))[1],a=i.exec(t(this).attr("class"))[2];else var e=t(this).attr(i.param_type),a=t(this).attr(i.param_id);"work"===e&&r.push(a),"edition"===e&&o.push(a)});var p=i.search+"e="+o.join(",")+"&w="+r.join(",");t.ajax({url:p,dataType:"json",async:i.async,success:function(e){"undefined"!=typeof e.works&&t.each(e.works[0].work,function(){var e=[];t.each(this.autors[0].autor,function(){e.push("undefined"!=typeof this.autor_id?'<a href="'+i.host+"autor"+this.autor_id+'">'+this.content+"</a>":this.content)}),e=e.join(", ");var a=(this.imgsmall?this.imgsmall[0]:"//data.fantlab.ru/images/editions/small/0",this.rusname&&this.rusname[0]?"<a style='font-size: 12px;font-weight: bold' href='"+i.host+"work"+this.id+"'>"+this.rusname[0]+"</a>":""),n="-";this.origname&&this.origname[0]&&(n=a&&""!==a?this.origname[0]:"<a style='font-size: 12px;font-weight: bold' href='"+i.host+"work"+this.id+"'>"+this.origname[0]+"</a>");var o=this.rating?this.rating[0].content:0,r=this.rating?this.rating[0].voters:0,p=this.worktype[0]?this.worktype[0]:"";p+=p&&this.year[0]>0?", ":"",p+=this.year[0]>0?this.year[0]+" г.":"";var h=i.corner+(e?"<p style='vertical-align: top;margin: 0;text-indent:0;margin-bottom:5px'>"+e+"</p>":"")+(a?"<p style='vertical-align: top;margin: 0;text-indent:0;margin-bottom:"+(n?"2":"8")+"px'>"+a+"</p>":"")+(n?"<p style='vertical-align: top;margin: 0;text-indent:0;margin-bottom:5px'>"+n+"</p>":"")+(p?"<p style='vertical-align: top;margin: 0;text-indent:0;margin-bottom:5px'>"+p+"</p>":"")+"<p style='vertical-align: top;margin: 0;text-indent:0;margin-bottom:3px'>Рейтинг: "+(r>0?"<font color=#C45E24><b>"+o+"</b></font> <font size=-2 color=gray>("+r+")</font>":"-")+"</p>",d=this;t(s).each(function(){i.params_in_class?t(this).hasClass("work_"+d.id)&&t(this).append('<div style="'+i.innercss_work+'">'+h+"</div>"):"work"===t(this).attr(i.param_type)&&t(this).attr(i.param_id)===d.id&&(t(this).append('<div style="'+i.innercss_work+'">'+h+"</div>"),t(this).focus(function(){this.blur()}))})}),"undefined"!=typeof e.editions&&t.each(e.editions[0].edition,function(){var e=[];t.each(this.autors[0].autor,function(){e.push("undefined"!=typeof this.autor_id?'<a href="'+i.host+"autor"+this.autor_id+'">'+this.content+"</a>":this.content)}),e=e.join(" ");var a=this.origname[0],n="";"undefined"!=typeof this.copies&&(n=this.copies[0]);var o="";"undefined"!=typeof this.pages&&(o="undefined"!==this.editiontype&&"аудиокнига"===this.editiontype[0]?"Продолжительность: "+(this.pages[0]>=60?Math.floor(this.pages[0]/60)+"ч. ":"")+this.pages[0]%60+"мин.":"Страниц: "+this.pages[0]);var r="";if("undefined"!=typeof this.year)var r=this.year[0];var p=[];"undefined"!=typeof this.isbns&&t.each(this.isbns[0].isbn,function(){p.push(this)}),p=p[0];var h=[];"undefined"!=typeof this.publishers&&t.each(this.publishers[0].publisher,function(){h.push(this.id?"<a href='"+i.host+"publisher"+this.id+"'>"+this.content+"</a>":this.content)}),h=h.join(", ");var d=i.corner+"<a href='"+i.host+"edition"+this.id+"'><img style='border: 0;float:left; padding-right: 10px;' src='"+this.cover_mini+"'></a><p style='margin-bottom:5px;text-indent:0;'>"+e+"</p><p style='margin-bottom:5px;text-indent:0;'><a style='font-size: 12px;font-weight: bold; margin: 5px 0;' href='"+i.host+"edition"+this.id+"'>"+a+"</a></p>"+(h||r?"<p style='font-size:10px;margin-bottom:2px;text-indent:0;'>"+h+(r?(h?", ":"")+r+" г.":"")+"</p>":"")+(n?"<p style='font-size:10px;margin-bottom:2px;text-indent:0;'>Тираж: "+n+"</p>":"")+(p?"<p style='font-size:10px;margin-bottom:2px;text-indent:0;'>ISBN: "+p+"</p>":"")+(o?"<p style='font-size:10px;margin-bottom:2px;text-indent:0;'>"+o+"</p>":""),l=this;t(s).each(function(){i.params_in_class?t(this).hasClass("edition_"+l.id)&&t(this).append('<div style="'+i.innercss_edition+'">'+d+"</div>"):"edition"===t(this).attr(i.param_type)&&t(this).attr(i.param_id)===l.id&&(t(this).append('<div style="'+i.innercss_edition+'">'+d+"</div>"),t(this).focus(function(){this.blur()}))})})}})}return this}}(jQuery);