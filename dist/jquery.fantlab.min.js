!function(t){var i,a={host:"http://fantlab.ru/",search:"https://api.fantlab.ru/search.json?",params_in_class:!1,cross_domain:!0,expr:/(work|edition)\_([0-9])+/gi,async:!0,param_type:"data-fantlab_type",param_id:"data-fantlab_id",innercss:"box-shadow: 1px 1px 2px rgba(0,0,0,0.2);font-family: Verdana, Arial; line-height: 1.2; cursor: default; vertical-align: top; position: absolute; padding: 10px; width: 230px; border-width: 1px 4px 1px 1px; border-style: solid; border-color: #adb4b8 #0079ab #adb4b8 #adb4b8; color: rgb(0, 0, 0); text-align: left; top: 27px; right: -200px; z-index: 999; outline: none; display: none; background-color: rgb(249, 250, 251);",corner:"<span style='display: block!important; box-shadow: -1px 1px 0px rgba(0,0,0,0.2);width: 12px;height: 12px; position: absolute;margin-left: 20px;margin-top: -16px;background-color: rgb(249,250,251);z-index: 980;-webkit-transform: rotate(135deg);transform: rotate(135deg);'></span>"};t.fn.fantlab=function(e){i=t.extend({},a,i,e);var s=this;t(this).on("mouseenter mouseleave",function(i){var a=t(this).find("div");"mouseenter"===i.type?(clearTimeout(a.data("timeout")),t.each(t(s).find("div"),function(i,e){var s=t(e);s.html()!==a.html()&&s.hide()}),a.data("timeout",setTimeout(function(){a.slideDown("fast")},600))):(clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){a.slideUp("fast")},300)))});var n=this,o=[],r=[];if(t(this).length>0){t.each(t(this),function(){if(t(this).attr("style","position:relative;"),i.params_in_class)var a=i.exec(t(this).attr("class"))[1],e=i.exec(t(this).attr("class"))[2];else var a=t(this).attr(i.param_type),e=t(this).attr(i.param_id);"work"===a&&r.push(e),"edition"===a&&o.push(e)});var h=i.search+"e="+o.join(",")+"&w="+r.join(",");t.ajax({url:h,dataType:"json",async:i.async,success:function(a){"undefined"!=typeof a.works&&t.each(a.works[0].work,function(){var a=[];t.each(this.autors[0].autor,function(){a.push("undefined"!=typeof this.autor_id?'<a traget="_blank" style="color: blue; text-decoration: none; font-size: 10px;" href="'+i.host+"autor"+this.autor_id+'">'+this.content+"</a>":this.content)}),a=a.join(", "),console.log(this);var e=this.imgsmall?this.imgsmall[0]:"//data.fantlab.ru/images/editions/small/0",s=this.rusname[0],o=this.year[0],r=this.rating?this.rating[0].content:0,h=this.rating?this.rating[0].voters:0,d=i.corner+"<a target='_blank' style='border: 0;text-decoration:none;' href='"+i.host+"work"+this.id+"'><img style='border: 0;float:left; padding-right: 10px;' src='"+e+"'></a><p style='vertical-align: top;margin: 0;'>"+a+"</p><a target='_blank' style='font-size: 12px;text-decoration:none; font-weight: bold; color: #000;' href='"+i.host+"work"+this.id+"'>"+s+"</a>"+(o>0?" <span style='font-size: 10px;'>("+o+")</span>":"")+"<br><b style='font-size: 20px; padding-top: 4px;'><span style='color: #C45E24'>"+r+"</span><span style='color: gray;'> / 10</span></b><br><span style='font-size: 11px;'>оценили: "+h+"<br/><span style='float:right;'><!--a target='_blank' style='color: gray; text-decoration: none; border-bottom: 1px gray dotted;' href='"+i.host+"work"+this.id+"'>fantlab.ru</a--></span></span>",p=this;t(n).each(function(){i.params_in_class?t(this).hasClass("work_"+p.id)&&t(this).append('<div style="'+i.innercss+'">'+d+"</div>"):"work"===t(this).attr(i.param_type)&&t(this).attr(i.param_id)===p.id&&(t(this).append('<div style="'+i.innercss+'">'+d+"</div>"),t(this).focus(function(){this.blur()}))})}),"undefined"!=typeof a.editions&&t.each(a.editions[0].edition,function(){var a=[];t.each(this.autors[0].autor,function(){a.push("undefined"!=typeof this.autor_id?'<a traget="_blank" style="color: blue; text-decoration: none; font-size: 10px;" href="'+i.host+"autor"+this.autor_id+'">'+this.content+"</a>":this.content)}),a=a.join(" ");var e=this.origname[0],s="";"undefined"!=typeof this.copies&&(s=this.copies[0]);var o="";"undefined"!=typeof this.pages&&(o=this.pages[0]);var r="";if("undefined"!=typeof this.year)var r=this.year[0];var h=[];"undefined"!=typeof this.isbns&&t.each(this.isbns[0].isbn,function(){h.push(this)}),h=h[0];var d=[];"undefined"!=typeof this.publishers&&t.each(this.publishers[0].publisher,function(){d.push("<a target='_blank' style='text-decoration:none; color: blue;' href='"+i.host+"publisher"+this.id+"'>"+this.content+"</a>")}),d=d.join(", ");var p=i.corner+"<a target='_blank' style='border: 0;text-decoration:none;' href='"+i.host+"edition"+this.id+"'><img style='border: 0;float:left; padding-right: 10px;' src='"+this.cover_mini+"'></a><p style='margin: 0 0 5px 0;vertical-align: top;'>"+a+"</p><p style='margin: 0 0 5px 0;'><a target='_blank' style='font-size: 12px;text-decoration:none; font-weight: bold; color: #000; margin: 5px 0;' href='"+i.host+"edition"+this.id+"'>"+e+"</a></p><span style='font-size: 10px;'>"+d+", "+r+" г.<br/>Тираж: "+s+"<br/>ISBN: "+h+"<br/>Страниц: "+o+"</span><span style='float:right;'><!--a traget='_blank' style='color: gray; text-decoration: none; border-bottom: 1px gray dotted; font-size: 13px;' href='"+i.host+"edition"+this.id+"'>fantlab.ru</a--></span>",l=this;t(n).each(function(){i.params_in_class?t(this).hasClass("edition_"+l.id)&&t(this).append('<div style="'+i.innercss+'">'+p+"</div>"):"edition"===t(this).attr(i.param_type)&&t(this).attr(i.param_id)===l.id&&(t(this).append('<div style="'+i.innercss+'">'+p+"</div>"),t(this).focus(function(){this.blur()}))})})}})}return this}}(jQuery);