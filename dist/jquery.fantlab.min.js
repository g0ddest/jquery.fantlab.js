!function(t){var i,a={host:"http://fantlab.ru/",search:"http://api.fantlab.ru/search.json?",params_in_class:!1,cross_domain:!0,expr:/(work|edition)\_([0-9])+/gi,async:!0,param_type:"data-fantlab_type",param_id:"data-fantlab_id",innercss:"font-family: Verdana, Arial;line-height:1.2;cursor:default;display:none;vertical-align:top;position:absolute;padding:10px;width:230px;border:1px solid #D2E0E8;border-left:2px solid #C45E24;background-color: #F9FAFB;color:#000;text-align:left;top:1.3em;right:-255px;z-index:999;outline: none;"};t.fn.fantlab=function(e){i=t.extend({},a,i,e);var s=this;t(this).on("mouseenter mouseleave",function(i){var a=t(this).find("div");"mouseenter"===i.type?(clearTimeout(a.data("timeout")),t.each(t(s).find("div"),function(i,e){var s=t(e);s.html()!==a.html()&&s.hide()}),a.data("timeout",setTimeout(function(){a.slideDown("fast")},600))):(clearTimeout(a.data("timeout")),a.data("timeout",setTimeout(function(){a.slideUp("fast")},300)))});var n=this;console.log(n);var o=[],r=[];if(t(this).length>0){t.each(t(this),function(){if(t(this).attr("style","position:relative;"),i.params_in_class)var a=i.exec(t(this).attr("class"))[1],e=i.exec(t(this).attr("class"))[2];else var a=t(this).attr(i.param_type),e=t(this).attr(i.param_id);"work"===a&&r.push(e),"edition"===a&&o.push(e)});var h=i.search+"e="+o.join(",")+"&w="+r.join(",");t.ajax({url:h,dataType:"json",async:i.async,success:function(a){"undefined"!=typeof a.works&&t.each(a.works[0].work,function(){var a=[];t.each(this.autors[0].autor,function(){a.push("undefined"!=typeof this.autor_id?'<a traget="_blank" style="color: #111; text-decoration: none; font-size: 13px;" href="'+i.host+"autor"+this.autor_id+'">'+this.content+"</a>":this.content)}),a=a.join(", ");var e=this.imgsmall[0],s=this.rusname[0],o=this.year[0],r=this.rating[0].content,h=this.rating[0].voters,d="<a target='_blank' style='text-decoration:none;' href='"+i.host+"work"+this.id+"'><img style='float:left; padding-right: 10px;' src='"+e+"'></a><span style='font-size: 12px; vertical-align: top;'>"+a+"</span><br><a target='_blank' style='text-decoration:none; font-weight: bold; color: #000;' href='"+i.host+"work"+this.id+"'>"+s+"</a>"+(o>0?" <span style='font-size: 13px;'>("+o+")</span>":"")+"<br><b style='font-size: 20px; padding-top: 4px;'><span style='color: #C45E24'>"+r+"</span><span style='color: gray;'> / 10</span></b><br><span style='font-size: 13px;'>оценили: "+h+"<br/><span style='float:right;'><a target='_blank' style='color: gray; text-decoration: none; border-bottom: 1px gray dotted;' href='"+i.host+"work"+this.id+"'>fantlab.ru</a></span></span>",l=this;t(n).each(function(){i.params_in_class?t(this).hasClass("work_"+l.id)&&t(this).append('<div style="'+i.innercss+'">'+d+"</div>"):"work"===t(this).attr(i.param_type)&&t(this).attr(i.param_id)===l.id&&(t(this).append('<div style="'+i.innercss+'">'+d+"</div>"),t(this).focus(function(){this.blur()}))})}),"undefined"!=typeof a.editions&&t.each(a.editions[0].edition,function(){var a=[];t.each(this.autors[0].autor,function(){a.push("undefined"!=typeof this.autor_id?'<a traget="_blank" style="color: #111; text-decoration: none; font-size: 13px;" href="'+i.host+"autor"+this.autor_id+'">'+this.content+"</a>":this.content)}),a=a.join(", ");var e=this.origname[0],s="";"undefined"!=typeof this.copies&&(s=this.copies[0]);var o="";"undefined"!=typeof this.pages&&(o=this.pages[0]);var r="";if("undefined"!=typeof this.year)var r=this.year[0];var h=[];"undefined"!=typeof this.isbns&&t.each(this.isbns[0].isbn,function(){h.push(this)}),h=h[0];var d=[];"undefined"!=typeof this.publishers&&t.each(this.publishers[0].publisher,function(){d.push("<a target='_blank' style='text-decoration:none; border-bottom: 1px gray dotted; color: #000;' href='"+i.host+"publisher"+this.id+"'>"+this.content+"</a>")}),d=d.join(", ");var l="<a target='_blank' style='text-decoration:none;' href='"+i.host+"edition"+this.id+"'><img style='float:left; padding-right: 10px;' src='http://img.fantlab.ru/editions/small/"+this.id+"'></a><span style='font-size: 12px; vertical-align: top;'>"+a+"</span><br><a target='_blank' style='text-decoration:none; font-weight: bold; color: #000;' href='"+i.host+"work"+this.id+"'>"+e+"</a><br/><span style='font-size: 12px;'>"+d+", "+r+" г.<br/>Тираж: "+s+"<br/>ISBN: "+h+"<br/>Страниц: "+o+"</span><span style='float:right;'><a traget='_blank' style='color: gray; text-decoration: none; border-bottom: 1px gray dotted; font-size: 13px;' href='"+i.host+"edition"+this.id+"'>fantlab.ru</a></span>",p=this;t(n).each(function(){i.params_in_class?t(this).hasClass("edition_"+p.id)&&t(this).append('<div style="'+i.innercss+'">'+l+"</div>"):"edition"===t(this).attr(i.param_type)&&t(this).attr(i.param_id)===p.id&&(t(this).append('<div style="'+i.innercss+'">'+l+"</div>"),t(this).focus(function(){this.blur()}))})})}})}return this}}(jQuery);